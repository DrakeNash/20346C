Module 1

Lab A: Setting up the Lucerne Publishing Datacenter Environment
---------------------------------------------------------------

Scenario

In this preliminary lab, you set up Lucerne Publishing’s datacenter for their “on-premises” infrastructure. This process requires students to set up a Windows® Live ID and sign up for a Microsoft Azure Learning Pass (both of which should have been done prior to class).

If students have not yet completed either of these tasks, they should do so now by performing the first two tasks in Exercise 1. Students can skip these tasks if they have already completed these steps.

Each student will then run a PowerShell® script in Microsoft Azure Active Directory that provisions this on-premises environment within Microsoft Azure. In this course, Microsoft Azure is used to represent both the Lucerne Publishing datacenter and the Lucerne Publishing corporate network. Microsoft Azure enables everyone in the classroom to have their own environment and public IP address, which means that Exchange can be migrated to Office 365, and Single Sign-On (SSO) can be enabled from any computer.

Objectives

By the end of this lab, you will have:

Signed up for a new Windows Live ID.

Signed up for Microsoft Azure.

Created the Lucerne Publishing datacenter environment.

Lab Setup

Estimated Time: The bulk of this lab is centered on the provisioning script that you run in Exercise 1, Task 4. Run times for this script during Microsoft’s testing have varied widely, ranging from 30 minutes to 4 hours, depending upon location, environment, and Azure system load. The average run time is usually around 2 to 3 hours, but a 4 hour run time should not be surprising. The lab should finish in time before your provisioned environment is needed by Module 2, Lab A. You should monitor the provisioning script periodically to ensure that it is running. If at any point you receive an error, perform Exercise 2, which recovers your environment so that you can re-run the provisioning script.

Virtual machine: 20346C-LUC-CL1

Username: **Student1**

Password: **Pa$$w0rd**

The classroom environment consists of the following virtual machines and domain names:

**Hyper-V virtual machines:**

**LUC-CL1** is a Windows 8 computer, representing a remote, non-domain-joined workstation. Runs on the classroom Hyper-V host.

**Azure virtual machines:**

**LUC-DC1** is the domain controller and DNS for Lucerne Publishing, and is hosted in Azure as part of the "Lucerne Publishing datacenter".

**LUC-EX1** is the on-premises Exchange server for Lucerne Publishing, and is hosted in Azure as part of the "Lucerne Publishing datacenter".

**LUC-SV1** and **LUC-SV2** are the AD FS server farm for Lucerne Publishing, and are hosted in Azure as part of the "Lucerne Publishing datacenter".

**LUC-SV3** is the AD FS Proxy server for Lucerne Publishing, and is hosted in Azure as part of the "Lucerne Publishing datacenter".

**LUC-CL2** and **LUC-CL3** simulate domain-joined workstations, but for this course are actually Windows Server 2012 computers with the Desktop Experience feature enabled, and are also hosted in Azure as part of the "Lucerne Publishing corporate network".

**Domain names:**

**LucernePublishing.local** is Lucerne Publishing's internal private domain name.

**LucernepublishingXXXX.onmicrosoft.com** is the temporary Office 365 domain assigned to Lucerne Publishing at the start of the pilot project, where XXXX is a unique Lucerne Publishing number that you will enter during Lab 1B in this module.

**LabXXXXX.o365ready.com** represents Lucerne Publishing's public domain name (such as LucernePublishing.com), where XXXXX is a unique O365ready.com number that you will enter in Lab 2B in the next module.

> ![](media/image1.wmf) **Note:** Lab usage is billed at the going commercial rate for the West US datacenter. All Azure-hosted virtual machines must be shut down each night to avoid excessive charges. Failure to shut them down may result in not having enough credits to complete the class. ***Do NOT shut down VMs in the Azure portal; this can result in IP address issues.***

### Exercise 1: Set Up and Configure the Lucerne Publishing Data Center Environment

Scenario

Lucerne Publishing currently has a datacenter in Geneva that hosts the company’s on-premises environment, which consists of Active Directory Domain Services, Exchange Server 2013, their document management system, customer relationship management (CRM) servers, and an enterprise resource planning (ERP) system. In effect, the IT department acts like an independent supplier and client computers connect to this datacenter environment over the Internet through its fixed IP address. Connectivity to the Internet is provided through a local Microsoft Threat Management Gateway server, which proxies out the requests to the data center.

In this lab, you set up and configure a simplified form of this data center environment, which includes a domain controller, an Exchange Server 2013 computer, two other domain-joined servers, a non-domain joined server and two client machines. You will use Windows Azure PowerShell scripts to carry out this automated process.

The primary setup script is **Provision.ps1**, which provisions your on-premises environment within Microsoft Azure. This script is designed so that if any errors occur while it was running, you can simply re-run the script and it will pick up from where it left off. If any errors occur when running the script originally, then re-running the script is the first step in the recovery process (see Exercise 2).

The Provision.ps1 script performs the following tasks:

Creates the Affinity Group if it does not exist.

Creates a storage account if it does not exist.

Copies the VHDs (storage blobs) that have not yet been copied.

Creates the VMs that do not yet exist.

**WARNING: IT IS ESSENTIAL THAT YOU DO NOT CLOSE THE WINDOWS AZURE POWERSHELL SESSION DURING THE BUILD PROCESS OR AT THE END OF THE LAB.**

If you accidentally close this session or restart the LUC-CL1 VM, you must perform the following steps before proceeding to their next exercise or task:

1.  On LUC-CL1, press the Windows key.

On the Start screen, right-click **Windows Azure PowerShell**, and then click **Run as administrator**.

At the User Account Control dialog box, click **Yes**.

At the Windows Azure PowerShell prompt, type the following command, and press Enter:

> **CD E:\\Setupfiles**.

At the Windows Azure PowerShell prompt, type the following command, and press Enter:

> **Set-ExecutionPolicy -Scope Process Unrestricted –Force**.

The main tasks for this exercise are as follows:

1. Sign up for a Windows Live Account (if needed)

2. Obtain Microsoft Azure Subscription (if needed)

3. Start LUC-CL1 and TMG Computers

4. Provision Lucerne Publishing “On-premises” Environment

5. Verify Domain Controller Setup (Optional)

6. Check Azure Account Balance

####   Task 1: Sign up for a Windows Live Account (if needed)

> **NOTE:** Students should have already completed Tasks 1 and 2 prior to arriving for this course. If you have not yet completed either of these tasks, then you should do so now. If you have completed both of these tasks, then proceed to Task 3.

1.  Log on to **LUC-CL1** with a user name of **Student1** and a password of **Pa$$w0rd**.

In the Start screen, click **Desktop**.

On the desktop task bar, click **Internet Explorer**.

In the address bar, enter **http://live.com** and press Enter.

Click **Sign up now**.

Under **Name**, enter your first and last name.

In **User name**, select a user name that is not currently in use.

Leave the domain name as **outlook.com**.

In **Create password** and **Reenter password**, enter a suitable eight-character or longer password. Make a note of this password.

Under **Country/Region**, select your local region.

Enter any additional information, such as ZIP code or post code.

Enter a **Birthdate**.

Select your **Gender**.

Under **Country code**, select the country code for your mobile device.

In **Phone number**, enter the number of your mobile phone.

In **Alternate email address**, enter your existing email address.

Under **Enter the characters you see**, type in the letters and numbers displayed. Click **New** for a different combination if required.

Click to clear the **Send me promotional offers from Microsoft, you can unsubscribe at any time** option.

Click **Create account**.

####   Task 2: Obtain Microsoft Azure Subscription (if needed)

1.  This course uses resources in Microsoft Azure and requires that students have a Microsoft Azure account. Learning Centers are authorized by Microsoft to assign Azure Learning Passes to students for this course.
    Each student’s Azure Learning Pass will provide them with an active Azure subscription that:

<!-- -->

1.  Supports 8 or more VM cores to complete the labs.

2.  Provides a $100 US credit. Costs of services used during the labs will be charged against this credit balance.

Ask your instructor for details if you have not yet been assigned your Azure Learning Pass.

####   Task 3: Start LUC-CL1 and TMG Computers

1.  On the student host computer, click **Start**, point to **Administrative Tools**, and click **Hyper-V Manager**. Alternatively, on Windows 8, press the Windows key, type **Hyper-V**, and then click **Hyper-V Manager** on the Start screen.

In **Hyper-V Manager**, right-click **MSL-TMG1** and click **Start**.

Right-click **20346C-LUC-CL1** and click **Start**.

Right-click **20346C-LUC-CL1** and click **Connect**.

Log on to LUC-CL1 as **Student1** with a password of **Pa$$w0rd**.

If scroll bars are visible on the desktop when you start up LUC-CL1, perform the remaining steps in this task to adjust the resolution of the screen to fit with your host computer’s monitor. If scroll bars are not visible, then proceed to the next task.

On LUC-CL1, right-click on the desktop and click **Screen resolution**.

In the **Screen Resolution** dialog box, next to **Resolution**, select **1024 x 768**, and click **Apply**.

Next to **Resolution**, select **1280 x 1024** and click **Apply**.

Check to see that there are no scroll bars on the desktop.

Click **OK** to close the Screen Resolution window.

####   Task 4: Provision Lucerne Publishing “On-premises” Environment

> Verbose messages in yellow or white
>
> Success messages in green
>
> Status messages in blue
>
> Error messages are usually red; these need to be addressed before proceeding.

1.  On LUC-CL1, press the Windows key.

On the **Start** screen, right-click **Windows Azure PowerShell**, and then click **Run as administrator**.

At the **User Account Control** dialog box, click **Yes**.

If the **Do you want to run software from this untrusted publisher?** prompt appears in Windows Azure PowerShell, type **A** and then press Enter.

At the **Windows Azure PowerShell** prompt, type the following command and press Enter:

**CD E:\\Setupfiles**

At the **Windows Azure PowerShell** prompt, type the following command and press Enter:

**Set-ExecutionPolicy -Scope Process Unrestricted -Force**

At the **Windows Azure PowerShell** prompt, type the following command and press Enter:

**Get-AzurePublishSettingsFile**

In Internet Explorer, sign in with the Live ID associated with your Azure account; this should be **username@outlook.com**, (where username@outlook.com is the Windows Live address you registered in Lab 1A, Exercise 1, Task 1).

At the **Internet Explorer Save File** dialog box, click the **Save** drop-down, and then click **Save as**.

Note the name of your publish settings file: \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
**Note:** File names can be quite long; therefore, if you are not familiar with using Autocomplete when typing file names, you can optionally change the name to a shorter, more user-friendly name when you save the file in the next step (for example, **XXX.publishsettings,** where XXX are your initials).

In the **Save As** dialog box, navigate to **E:\\Setupfiles**, and click **Save**.

Switch to the **Windows Azure PowerShell** prompt, type the following command and press Enter:

**Import-AzurePublishSettingsFile -PublishSettingsFile "E:\\Setupfiles\\*name of your downloaded publish settings file*"**

To run the first provisioning script, at the **Windows Azure PowerShell** prompt, type the following command and press Enter:

**. .\\Provision.ps1**

**
Important:** The command starts with dot space dot backslash.**
Note:** If you get red script errors, you should stop the script execution by pressing Ctrl + C, and then proceed to **Exercise 2 (Recover from Provisioning Errors)**.

When prompted, enter the eight-digit number for your Learning Center and press Enter. Your instructor will provide you with this number.

When prompted, enter your three-digit student number and press Enter. Your instructor will provide you with this number.

Make a note of your "unique suffix" from the Window Azure prompt; you will need this later in this lab:
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

Microsoft’s testing has shown that Provision.ps1 run times have varied widely, ranging from 30 minutes to 4 hours, depending upon location, environment, and Azure system load. The average run time is usually around 2 to 3 hours, but a 4 hour run time should not be surprising. The lab should finish in time before your provisioned environment is needed by Module 2, Lab A.
**Important:** While the script is running, the instructor should continue with the rest of the course, starting with the lecture content in **Lesson 1, Introduction to Office 365**. You can proceed up to **Module 2, Lab A** while the script is running.
**Note:** If you get red script errors, you should stop the script execution by pressing Ctrl + C, and then proceed to **Exercise 2 (Recover from Provisioning Errors)**.

When the script has completed, type the following command at the **Windows Azure PowerShell** prompt and press Enter:

| Name      | InstanceStatus | PowerState | IPAddress |
|-----------|----------------|------------|-----------|
| LUC-CL3   | ReadyRole      | Started    | 10.0.0.10 |
| LUC-CL2   | ReadyRole      | Started    | 10.0.0.9  |
| LUC-SV1   | ReadyRole      | Started    | 10.0.0.6  |
| LUC-DC1   | ReadyRole      | Started    | 10.0.0.4  |
| LUC-EX1   | ReadyRole      | Started    | 10.0.0.5  |
| LUC-SV2   | ReadyRole      | Started    | 10.0.0.7  |
| LUC-SV3   | ReadyRole      | Started    | 10.0.0.8  |

**IMPORTANT**: If any of the Azure virtual machines in the prior table was not created, then you must re-run the Provision.ps1 script by repeating steps 13-18.
You should only proceed to the next task if the provisioning script completed with no errors and all of the expected Azure virtual machines were created.

####   Task 5: Verify Domain Controller Setup (Optional)

1.  On **LUC-CL1**, on the Taskbar, click **File Explorer**.

Navigate to **E:\\RDP\_files**, and verify the following files exist:

1.  LUC-DC1.rdp

2.  LUC-EX1.rdp

3.  LUC-SV1.rdp

4.  LUC-SV2.rdp

5.  LUC-SV3.rdp

6.  LUC-CL2.rdp

7.  LUC-CL3.rdp

**Note**: You have the option to download and install Remote Desktop Connection Manager (RDCMan) on LUC-CL1 or onto the local host computer to manage the Microsoft Azure RDP sessions. RDCMan is available from [*http://go.microsoft.com/fwlink/?LinkId=401125*](http://go.microsoft.com/fwlink/?LinkId=401125).

Double-click **LUC-DC1.rdp.**

If a Remote Desktop Connection warning message appears, click **Don’t ask me again for connections to this computer** and click **Connect**.

Connect as **LUCERNE\\LucAdmin**, password: **Pa$$w0rd**.

If another Remote Desktop Message appears, click **Don’t ask me again for connections to this computer** and click **Yes**.
**Note:** When connecting to LUC-DC1, Microsoft’s testing has, on rare occasions, received a message asking if you want to install updates. Do NOT install updates if such a message appears.

On **LUC-DC1**, in **Server Manager**, click **Tools** and then click **Active Directory Users and Computers**.

In the **Lucerne Publishing** domain, verify that the following organizational units (OU) are empty: **Accounts**, **Engineering,** and **Sales**.

In the **Lucerne Publishing** domain, verify that the **Computers** OU contains the following computers:

1.  LUC-EX1

2.  LUC-SV1

3.  LUC-SV2

4.  LUC-CL2

5.  LUC-CL3

Verify server to server communications by pinging the following IP addresses. To ping a server open a command prompt and type **ping \<IP address\>** (e.g. ping 10.0.0.5).

1.  10.0.0.5

2.  10.0.0.6

3.  10.0.0.7

4.  10.0.0.8

Minimize the RDP session.

####   Task 6: Check Azure Account Balance

> ![](media/image1.wmf) **Note:** Lab usage is billed at the going commercial rate for the West US datacenter. All Azure-hosted virtual machines must be shut down each night to avoid excessive charges. Failure to shut them down may result in not having enough credits to complete the class.
> ***WARNING:** **Do NOT shut down VMs in the Azure portal; this can result in IP address issues***.

1.  To check your Azure account balance, in a browser, go to: **http://azure.microsoft.com/en-us/**

Click **Portal.**

Sign in using the Microsoft Account associated with your Azure subscription.

At the top of the page click on the box at the top center of the page that says **Credit Status or Account Status** to see your current balance.

You do not need the Azure Portal for any additional lab steps in this course. However, it can be left logged in so that you can monitor progress against your account balance.

**Results**: At the end of the lab, you will have a working “on-premises” environment in the Lucerne Publishing data center. In reality, this environment is hosted in Microsoft Azure.

### Exercise 2: Recover from Provisioning Errors (If Required)

Scenario

There is no scenario for this exercise.

**IMPORTANT:** You should only perform the tasks in this exercise if you have experienced problems when setting up and configuring the Lucerne Publishing Datacenter environment in Lab A, Exercise 1, Task 4.

There are three parts to the recovery process. The first two parts (Recovery Steps 1 and 2) have been designed to automatically recover from the errors received. If errors still occur after running both of these automated processes, then you must manually perform a series of steps (in Recovery Step 3) to remove the Azure artifacts before attempting to provision the Lucerne Datacenter one last time. The recovery process has been designed so that hopefully one of the automated processes in Recovery Steps 1 or 2 fixes the problem, thereby saving you from having to manually perform the steps in Recovery Step 3. However, if both of the automated fixes do not resolve the issue, then you must perform the manual process to complete the provisioning.

A summary of the recovery process is as follows:

1.  **Recovery Step 1 – Re-run Provision.ps1.** In most cases, re-running the Provision.ps1 script will fix the problem.

If this fixes the problem, then skip Recovery Steps 2 and 3 and continue with Lab A, Exercise 1, Task 4, starting with step 14.

However, if re-running Provision.ps1 again fails, then proceed to Recovery Step 2.

**Recovery Step 2 – Run RemoveAll.ps1 and then Re-run Provision.ps1.** If re-running Provision.ps1 in the prior step still results in an error, then run the RemoveAll.ps1 script before re-running Provision.ps1 again.

1.  If this fixes the problem, then skip Recovery Step 3 and continue with Lab A, Exercise 1, Task 4, starting with step 14.

However, if re-running Provision.ps1 fails again after having run the RemoveAll.ps1 script, then proceed to Recovery Step 3.

**Recovery Step 3 – Perform Manual Recovery Steps and then Re-run Provision.ps1.** If the provisioning script still encounters an error after you ran RemoveAll.ps1, then you must manually remove the Azure artifacts before re-running the provisioning script.

1.  If this fixes the problem, then continue with Lab A, Exercise 1, Task 4, starting with step 14.

However, if re-running Provision.ps1 fails after you manually performed the recovery steps in this task, then contact your instructor.

The main tasks for this exercise are as follows:

1. Recovery Step 1 – Re-run Provision.ps1

2. Recovery Step 2 – Run RemoveAll.ps1 and then Re-run Provision.ps1 (If Required)

3. Recovery Step 3 – Perform Manual Recovery Steps and then Re-run Provision.ps1 (If Required)

####   Task 1: Recovery Step 1 – Re-run Provision.ps1

1.  At the **Windows Azure PowerShell** prompt, type the following command and press Enter:
    **. .\\Provision.ps1**
    **Note:** Your next step depends on whether you receive any errors when running the provisioning script.

**No errors; Successful recovery:** If the provisioning script prompts you for your 8 digit Learning Center number without encountering an error, then return to **Exercise 1,** **Task 4** (Provision Lucerne Publishing “On-premises” Environment) starting with step 14, where you will enter the 8 digit Learning Center number and continue with the provisioning process.

**Errors occurred; Failed recovery:** If you get red script errors, you should stop the script execution by pressing Ctrl + C, and then proceed to **Task 2: Recovery Step 2**.

####   Task 2: Recovery Step 2 – Run RemoveAll.ps1 and then Re-run Provision.ps1 (If Required)

1.  On LUC-CL1, press the Windows key.

On the **Start** screen, right-click **Windows Azure PowerShell**, and then click **Run as administrator**.

At the **User Account Control** dialog box, click **Yes**.

If the **Do you want to run software from this untrusted publisher?** prompt appears in **Windows Azure PowerShell**, type **A** and then press Enter.

At the **Windows Azure PowerShell** prompt, type the following command and press Enter:

**CD E:\\Setupfiles**

At the **Windows Azure PowerShell** prompt, type the following command and press Enter:

**Set-ExecutionPolicy -Scope Process Unrestricted -Force**

At the **Windows Azure PowerShell** prompt, type the following command and press Enter:

**. .\\RemoveAll.ps1**

At the **Windows Azure PowerShell** prompt, type the following command, and press Enter:
**. .\\Provision.ps1**
**Note:** Your next step depends on whether you receive any errors when running the provisioning script.

**No errors; Successful recovery:** If the provisioning script prompts you for your 8 digit Learning Center number without encountering an error, then return to **Exercise 1,** **Task 4 (**Provision Lucerne Publishing “On-premises” Environment) starting with step 14, where you will enter the 8 digit Learning Center number and continue with the provisioning process.

**Errors occurred; Failed recovery:** If you get red script errors, you should stop the script execution by pressing Ctrl + C, and then proceed to **Task 3: Recovery Step 3**.

####   Task 3: Recovery Step 3 – Perform Manual Recovery Steps and then Re-run Provision.ps1 (If Required)

1.  In **LUC-CL1**, run **Windows PowerShell**.

On the Taskbar, click **Internet** **Explorer**.

In the address bar, type **http://manage.windowsazure.com** and press Enter.

Sign in with the Live ID associated with your Azure account; this should be **username@outlook.com**, (where username@outlook.com is the Windows Live address you registered in Lab 1A, Ex 1 Task 1).

In the Microsoft Azure portal, click **VIRTUAL MACHINES**.

In the virtual machines list, click **LUC-DC1**, and on the bottom bar, click **DELETE**, and then click **Delete the attached disks**. If virtual machine **LUC-DC1** is not listed, go to step 9.

At the confirmation prompt, click **YES**.

Wait until the deletion has completed.

In the virtual machines list, click **LUC-EX1**, and on the bottom bar, click **DELETE**, and then click **Delete the attached disks**. If virtual machine **LUC-EX1** is not listed, go to step 12.

At the confirmation prompt, click **YES**.

Wait until the deletion has completed.

In the virtual machines list, click **LUC-SV1**, and on the bottom bar, click **DELETE**, and then click **Delete the attached disks**. If virtual machine **LUC-SV1** is not listed, go to step 15.

At the confirmation prompt, click **YES**.

Wait until the deletion has completed.

In the virtual machines list, click **LUC-SV2**, and on the bottom bar, click **DELETE**, and then click **Delete the attached disks**. If virtual machine **LUC-SV2** is not listed, go to step 18.

At the confirmation prompt, click **YES**.

Wait until the deletion has completed.

In the virtual machines list, click **LUC-SV3**, and on the bottom bar, click **DELETE**, and then click **Delete the attached disks**. If virtual machine **LUC-SV3** is not listed, go to step 21.

At the confirmation prompt, click **YES**.

Wait until the deletion has completed.

In the virtual machines list, click **LUC-CL2**, and on the bottom bar, click **DELETE**, and then click **Delete the attached disks**. If virtual machine **LUC-CL2** is not listed, go to step 24.

At the confirmation prompt, click **YES**.

Wait until the deletion has completed.

In the virtual machines list, click **LUC-CL3**, and on the bottom bar, click **DELETE**, and then click **Delete the attached disks**. If virtual machine **LUC-CL3** is not listed, go to step 27.

At the confirmation prompt, click **YES**.

Wait until the deletion has completed.

In the Microsoft Azure portal, click **CLOUD SERVICES**, and on the bottom bar, click **DELETE**. If no **Cloud Services** object is listed, go to step 30.

At the confirmation prompt, click **YES**.

Wait until the deletion has completed.

In the Microsoft Azure portal, click **NETWORKS** and on the bottom bar, click **DELETE**; if no virtual network is listed, go to step 33.

At the confirmation prompt, click **YES**.

Wait until the deletion has completed.

In the Microsoft Azure portal, on the networks page, click **DNS SERVERS** and on the bottom bar, click **DELETE**; if no DNS is listed, go to step 36.

At the confirmation prompt, click **YES**.

Wait until the deletion has completed.

In the Microsoft Azure portal, click **STORAGE** and on the bottom bar, click **DELETE**; if no storage is listed, go to step 39.

At the confirmation prompt, click **YES**.

Wait until the deletion has completed.

In the Microsoft Azure portal, click **SETTINGS**, then click **AFFINITY GROUPS**, and then, on the bottom bar, click **DELETE**. If no Affinity Group object is listed, go to step 42.

At the confirmation prompt, click **YES**.

Wait until the deletion has completed.

At the **Windows Azure PowerShell** prompt, type the following command and press Enter:
**. .\\Provision.ps1**
**Note:** Your next step depends on whether you receive any errors when running the provisioning script.

**No errors; Successful recovery:** If the provisioning script prompts you for your 8 digit Learning Center number without encountering an error, then return to **Exercise 1,** **Task 4** (Provision Lucerne Publishing “On-premises” Environment) starting with step 14, where you will enter the 8 digit Learning Center number and continue with the provisioning process.

**Errors occurred; Failed recovery:** If you get red script errors, you should stop the script execution by pressing Ctrl + C, and then contact your instructor.

Lab B: Preparing for Office 365
-------------------------------

Scenario

The labs in this course involve Lucerne Publishing, a global media corporation based in Geneva, Switzerland. Lucerne Publishing currently uses a dedicated data center to run its on-premises environment but is looking to move to Office 365 over the next three months. Remi Desforges, the long-serving Chief Information Officer (CIO), has been instructed to ensure the migration project goes smoothly. He has appointed Justin Muller, the Chief Technology Officer, to head up the team. Justin has engaged Alain Richer as the partner Office 365 implementation consultant.

Objectives

By the end of this lab, you should be able to:

Plan for a FastTrack Pilot of Office 365.

Provision tenant accounts in Office 365.

Set up a management computer.

Check client connectivity to Office 365.

Lab Setup

Estimated Time: 75 minutes

Virtual machine: 20346C-LUC-CL1

Username: **Student1**

Password: **Pa$$w0rd**

This lab is partly a paper-based planning lab and partly hands-on. You should check your answers against the lab instruction to ensure that you have the right answers for a particular section before moving onto the next one.

Where you see references in the steps to **lucernepublishingXXXX.onmicrosoft.com**, you should replace **XXXX** with the unique Lucerne Publishing code that you assigned when you set up your Office 365 accounts in Module 1, Lab 1B, Exercise 2, Task 3, Step 5.

### Exercise 1: Planning a FastTrack Pilot

Scenario

Alain Richer needs to create a plan for the FastTrack pilot at Lucerne Publishing; therefore, he needs to ask Justin and his team some questions. He sets up a meeting with Justin Muller, Heidi Leitner (the Network Manager), and Coralie Emond from the IT Department. Heidi has been assigned the task of working with Alain to set up the company account on Office 365, and Coralie will be involved in the day-to-day administration.

The main tasks for this exercise are as follows:

1. Extracting Customer Information

2. Extracting Customer Information - Answers

3. Identifying Activities within the FastTrack Pilot

4. Identifying Activities within the FastTrack Pilot – Answers

####   Task 1: Extracting Customer Information

1.  You are Alain. What discussion headings should you bring to this meeting to ensure you extract the information that you need from Lucerne Publishing to start planning the FastTrack Pilot?

When you have listed your questions, go to the next Task for the answers.

####   Task 2: Extracting Customer Information - Answers

This task provides the answers to the question from the prior task.

1.  The headings that Alain would use are as follows.

<!-- -->

1.  **Services** – what Office 365 services do you want to Pilot?

2.  **Users** – what do they do and where do they work?

3.  **Devices** – what devices do users have and is there a bring-your-own-device policy in place?

4.  **IT delivery** – how does the company currently deliver IT and how is this service viewed and managed?

5.  **Workloads** – what workloads does the company have that can’t be migrated to Office 365?

6.  **Pilot users** – how many do there need to be and in which departments?

7.  **Management support** – what is the attitude to the cloud within the company and do we have executive support?

8.  **Success Criteria** – how will you define success and how will you measure it?

9.  **Feedback** – how are you going to capture feedback about the pilot?

The answers from the Lucerne Publishing team are set out below.

1.  **Services** – what Office 365 services do you want to Pilot?

> Everything except Project and Visio.
>
> Definitely moving from Exchange Server on-premises to Exchange Online.
>
> Keep in-house document management but evaluate SharePoint Online.
>
> Very interested in Lync – don’t currently have it.
>
> Yes to OneDrive for Business.
>
> Yes to Yammer.

1.  **Users** – what do they do and where do they work?

> Executive team of 50, spread all over the world, including the heads of the remote headquarters.
>
> Below them are 255 management level personnel, who work either here at HQ or in the regional offices.
>
> Around 1,600 employees, some at HQ, some in the regional offices, and a few working from home occasionally.
>
> More than 2,500 freelancers who work from home, but they’re not going to be part of this phase.

1.  **Devices** – what devices do users have and is there a bring-your-own-device policy in place?

> Senior Execs can use whatever they like.
>
> Some of them are on iPads, some on Android tablets, a few more on Windows RT devices and some with PCs.
>
> Same BYOD policy for management, although they do tend to be more PC-based and more static in terms of their locations.
>
> Employees are all provided with PCs, either workstations or laptops.
>
> Associates use whatever they want as long as it is compatible with the company’s file formats.

1.  **IT delivery** – how does the company currently deliver IT and how is this service viewed and managed?

> IT is very much a centralized function.
>
> Main corporate data center here in Switzerland. The company doesn’t actually say where it’s physically located, but they do have very good network connectivity from HQ. The architecture is based on Microsoft’s private cloud design, although they haven’t fully virtualized all the workloads yet.

1.  **Workloads** – what workloads does the company have that can’t be migrated to Office 365?

> The company has the following workloads that cannot be migrated at the moment:
>
> Content management system (although that may migrate to SharePoint later) together with its SQL Server database.
>
> The ERP system.
>
> The HR system and database.
>
> Everything else could potentially migrate to the cloud.

1.  **Pilot users** – how many do there need to be and in which departments?

> Five percent of users results in around 100 pilot users. These should be a representative sample from the departments, but not include mission-critical users such as Helpdesk staff.

1.  **Management support** – what is the attitude to the cloud within the company and do we have executive support?

> The CEO does not deal with that level of technical detail any more. However, the COO is keen to move the project forward.

1.  **Success Criteria** – how will you define success and how will you measure it?

> Success will come from the pilot users. If they like the experience of using Office 365 and let the company know, then the company will consider the pilot a success.

1.  **Feedback -** how are you going to capture feedback about the pilot?

-   The company already has a web-based feedback system setup. This internally-designed system records and collates the information on the pilot.

####   Task 3: Identifying Activities within the FastTrack Pilot

1.  You are assembling the information into a FastTrack Pilot phase plan. Outline the activities that need to take place and highlight any factors that should be included in your planning.

When you have listed the activities in the Pilot phase, go to the next Task to review the answers.

####   Task 4: Identifying Activities within the FastTrack Pilot – Answers

This task provides the answers to the question from the prior task.

1.  A FastTrack Pilot should include the following activities:

<!-- -->

1.  Sign up for Office 365.

2.  Set up the pilot domain for Lucerne Publishing (for example, lucernepublishing.onmicrosoft.com).

3.  Add the pilot users.

4.  Connect their existing email accounts.

5.  Set up a team collaboration site for your pilot.

6.  Prepare the pilot users.

7.  Test the pilot configuration with the pre-pilot users.

8.  Run the pilot.

Complete the pilot and prepare to move to the Deploy phase.

**Results**: Lucerne Publishing has signed off on the FastTrack Pilot and wants to test Office 365 in its environment. The company has been provided with a connectivity testing plan and a deployment timetable for the Office 365 implementation.

### Exercise 2: Provisioning the Tenant Account

Scenario

The day before the pilot is due to start, Alain meets with Heidi to set up the organization’s Office 365 account. He needs to ensure that they have the right information to set up the Pilot tenant account.

> ![](media/image1.wmf) **Note:** For simplicity, this lab uses an ordinary Office 365 trial account, not a FastTrack pilot extended tenant account. Also note that you need to create an account with a unique name in the form: **lucernepublishingXXXX.onmicrosoft.com**. You can use any alphanumeric value for XXXX that the Office 365 website accepts.

When you set up the tenant account for Lucerne Publishing, you will be allocated a **lucernepublishingXXXX.onmicrosoft.com** domain, where **XXXX** is a four character alphanumeric code that you assign.

Make note of this XXXX code as you will need it to complete the remaining labs in this course.

The main tasks for this exercise are as follows:

1. Gathering the Required Information

2. Gathering the Required Information - Answers

3. Creating the Tenant Account

4. Checking the Office 365 Service Status

####   Task 1: Gathering the Required Information

1.  You are Alain. List the fields that Heidi will need to complete when setting up the tenant administrator account in her name.

When you have listed the fields, go to the next Task to see the information that Heidi has provided for each field.

####   Task 2: Gathering the Required Information - Answers

This task provides the answers to the question from the prior task.

1.  Heidi needs to provide the following information to set up the tenant account:

<!-- -->

1.  Country

2.  First name

3.  Last name

4.  Email

5.  Address 1

6.  Postal code

7.  City

8.  Canton abbreviation

9.  Phone:

10. Organization name

11. User ID

12. Administrator Password

13. Text verification option

In response, Heidi provides the following information:

1.  Country: **Switzerland**

2.  First name: **Heidi**

3.  Last name: **Leitner**

4.  Email: **Heidi’s Windows Live account**

5.  Address 1: **Rue Le-Royer**

6.  Postal code: **1211**

7.  City: **Geneva**

8.  Canton abbreviation: **GE**

9.  Phone: **Heidi’s mobile phone number, including international code **

10. Organization name: **Lucerne Publishing**

11. User ID: **hleitner@LucernepublishingXXXX.onmicrosoft.co**m

12. Administrator Password: **Pa$$w0rd**

13. Text verification options: **Your mobile phone number**

####   Task 3: Creating the Tenant Account

1.  On LUC-CL1, logged on as **Student 1**, on the Task bar, click **Internet Explorer**.

In the Address bar, type **http://aka.ms/20346** and press Enter.

For Step 1, in the **Start your free 30-day trial** page, complete the following fields. Regardless of your location, use the following information:

1.  **Country**: Switzerland

2.  **First name**: Heidi

3.  **Last name**: Leitner

4.  **Business email address**: (use your new Windows Live account that you created for this course)

5.  **Business phone number**: Your mobile phone number, including international code for your current country

6.  **Company name**: Lucerne Publishing

Click **Next**.

For Step 2, you have to create a unique domain for the Company name to use in the course. It is recommended that you choose a four character alphanumeric code and append it after **lucernepublishing**. You may have to try a few numeric or alphanumeric combinations to create a unique domain value. For the rest of the fields use the following information:

1.  **User name**: hleitner

2.  **Company name**: lucernepublishingXXXX (where XXXX is your unique Lucerne Publishing number)

3.  **Password**: Pa$$w0rd

4.  **Confirm password**: Pa$$w0rd

**MAKE A NOTE OF THE XXXX CODE AFTER LUCERNEPUBLISHING.** You will use this in all subsequent labs and enter it whenever you are asked to supply a **@lucernepublishingXXXX.onmicrosoft.com** logon or web site URL.

Click **Next.**

For Step 3, you have to confirm your identity using your mobile phone. Under **Send text message**, from the drop-down box, select the code for the country that you are now in.

In the **Mobile phone number** box, enter your correct mobile phone number.

Ensure that the **Send text message** option is selected, and then click **Text me**.

When you receive the confirmatory text on your mobile phone, enter that in the **Enter your verification code** box.

Under **Microsoft Online Services may contact me with information about their products, services and events**, clear the **Email** and **Phone** options.

Click **Create my account**.

Wait until the Office 365 tenant is provisioned and then click on **You’re ready to go…**

On the **Don’t lose access to your account** page, the **Mobile phone number** and **Alternate email address** fields are required. If either field is blank, enter the appropriate information. Click **Save** and **continue**.

Click on the **Admin** tile to go to the Office 365 administrative portal.

####   Task 4: Checking the Office 365 Service Status

1.  Click on **Service Health** on the left-hand menu, then click on **Service Health** again to display the Service Health Dashboard.

Click on **View details and history**.

Review the information under **Current status**. Note that at this point, services will still be initializing.

Review any service interruption records or additional information in the status page.
**Note:** During Microsoft’s testing, on rare occasions Office 365 did not create the trial tenant properly; as a result, the tenant did not have all the services available to it. If this happens to you, you should create a new trial tenant using a different business email (Windows Live account).

Click the **RSS** button. A new Internet Explorer tab opens.

Click **Subscribe to this feed**.

In the **Subscribe to this feed** dialog box, click **Add to Favorites Bar** and click **Subscribe**.
Click **View my feeds** and confirm that **Office 365 Service Health RSS Notifications** has been added to your feeds.

Close Internet Explorer.

If prompted, click **Close all tabs**.

**Results**: You have successfully provisioned the Office 365 tenant account for Lucerne Publishing.

### Exercise 3: Preparing to Manage Office 365

Scenario

Lucerne Publishing has accepted the pilot plan but the implementation team feels there is a lack of clarity about how to manage Office 365, the effectiveness of client connectivity to Office 365, and the changes that might need to be made to provide this connectivity.

Following a tense meeting between Remi, Justin, Heidi, and Alain, Lucerne Publishing provides the necessary information. Alain needs to confirm that the management computers meet certain requirements, the right ports are open, and that users can connect from those locations to the Office 365 service centers in each country. Heidi is pretty sure connectivity will not be a problem but decides to check anyway.

The main tasks for this exercise are as follows:

1. Configuring a Management Computer

2. Checking Client Connectivity

####   Task 1: Configuring a Management Computer

1.  Switch to the LUC-CL1 virtual machine.

Press the Windows key, and click **File Explorer**.

In File Explorer, navigate to **E:\\Labfiles\\Lab01**.

Double-click **msoidcli\_64**.

In the **Microsoft Online Services Sign-in Assistant Setup** wizard, on the **License Terms** page, click **I accept the terms in the License Agreement and Privacy Statement**, and click **Install**.

In the **User Account Control** dialog box, click **Yes**.

On the **Completed the Microsoft Online Services Sign-in Assistant Setup Wizard** page, click **Finish**.

In File Explorer, in **E:\\Labfiles\\Lab01**, double-click **AdministrationConfig-EN**.

In the **Microsoft Azure Active Directory Module for Windows PowerShell Setup** wizard, on the **Welcome** page, click **Next**.

On the **License Terms** page, click **I accept the terms in the License**, and click **Next**.

On the **Install Location** page, click **Next**.

On the **Ready to Install** page, click **Install**.

In the **User Account Control** dialog box, click **Yes**.

On the **Completing the Microsoft Azure Active Directory Module for Windows PowerShell Setup** page, click **Finish.**

####   Task 2: Checking Client Connectivity

1.  On LUC-CL1, on the Task Bar, click **Internet Explorer**.

In the Address bar, enter **https://testconnectivity.microsoft.com/**.

In the **Microsoft Remote Connectivity Analyzer** page, click the **Office 365** tab.

In the Office 365 tab, click **Office 365 Exchange Domain Name Server (DNS) Connectivity Test**, and click **Next**.

Under **Domain Name**, enter **lucernepublishingXXXX.onmicrosoft.com** (where XXXX is your unique Lucerne Publishing number).

Under **Verification**, enter the characters that you can see into the verification field, and click **Verify**. Note that the verification code is not case-sensitive.

Click **Perform Test**.

When you see **Connectivity Test Successful**, under **Test Details**, expand **Test Steps** and review the checks that have been made against the Exchange Online domain.

Click **Start Over**.

In the **Office 365** tab, click **Office 365 Lync Domain Name Server (DNS) Connectivity Test**, then click **Next**.

In the **Sign-in address** field, enter **hleitner@lucernepublishingXXXX.onmicrosoft.com** (where XXXX is your unique Lucerne Publishing number), then click **Perform Test**.

When you see **Connectivity Test Successful**, under **Test Details**, expand **Test Steps** and review the checks that have been made against the Lync Online domain.

Click **Start Over**.

In the **Office 365** tab, under **Microsoft Exchange ActiveSync Connectivity Tests**, click **Exchange ActiveSync**, then click **Next**.

In **Exchange ActiveSync**, select **Use Autodiscover to detect server settings**, then under **Email Address**, enter **hleitner@lucernepublishingXXXX.onmicrosoft.com** (where XXXX is your unique Lucerne Publishing number).

In **Microsoft Account**, enter **hleitner@lucernepublishingXXXX.onmicrosoft.com** (where XXXX is your unique Lucerne Publishing number).

In **Password** and **Confirm password**, enter **Pa$$w0rd**.

Check **Ignore Trust for SSL**.

Check **I understand that I must use the credentials of a working account from my Exchange domain to be able to test connectivity to it remotely. I also acknowledge that I am responsible for the management and security of this account**.

Click **Perform Test**.

When you see **Connectivity Test Successful**, under **Test Details**, expand **Test Steps** and review the checks that have been made against Exchange ActiveSync.

Click **Start Over**.

Under **Microsoft Office Outlook Connectivity Tests**, click **Outlook Connectivity**, then click **Next**.

In **Outlook Anywhere (RPC over HTTP)**, in **Email Address** and **Microsoft Account**, enter **hleitner@lucernepublishingXXXX.onmicrosoft.com** (where XXXX is your unique Lucerne Publishing number).

In **Password** and **Confirm password**, enter **Pa$$w0rd**.

Select **Use Autodiscover to detect server settings**.

Check **I understand that I must use the credentials of a working account from my Exchange domain to be able to test connectivity to it remotely. I also acknowledge that I am responsible for the management and security of this account**.

Click **Perform Test**.

When you see **Connectivity Test Successful with Warnings**, under **Test Details**, expand **Test Steps** and review the checks that have been made against **Outlook Anywhere**. Note in particular the **Autodiscover** steps that fail.

Under **Run Test Again** at the top right, note that you can copy this test to the clipboard, or save it as XML or HTML.

Close Internet Explorer.

**Results**: Lucerne Publishing has installed the management tools on a client computer and tested client connectivity.
